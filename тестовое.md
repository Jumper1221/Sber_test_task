# Техническое задание (ТЗ) на разработку сервиса платежей

## 1. Общее описание

Необходимо разработать сервис по созданию и подтверждению платежей на базе FastAPI с использованием PostgreSQL в качестве основной базы данных. Сервис должен обеспечивать аутентификацию пользователей, сохранение информации о платежах в БД и предоставлять API для взаимодействия с внешними системами или фронтендом.

Разработка предполагается в рамках тестового задания для кандидата на позицию Junior Python Developer.

## 2. Стек технологий

- **Backend**: FastAPI
- **База данных**: PostgreSQL
- **Асинхронность**: Функции и методы должны быть асинхронные
- **Оркестрация контейнеров**: Docker Compose
- **Фронтенд** (по желанию): может быть реализован на любом удобном фреймворке (например, React, Vue, Flask-шаблоны)
- **Язык программирования**: Python 3.10+
- **ORM**: SQLAlchemy + Pydantic
- **Аутентификация**: JWT
- **Использование ИИ и автоматизации**: приветствуется

## 3. Основные функциональные требования

### 3.1. Аутентификация пользователя

- Реализовать регистрацию и вход пользователей.
- Выдача токена (JWT или session) после успешного входа.
- Защита эндпоинтов через middleware или зависимости (Depends).

### 3.2. Создание платежа

Пользователь может создать новый платёж со следующими данными:

- Номер карты (4 последних цифры)
- ФИО владельца карты
- Сумма платежа
- Дата и время создания (автоматически)
- Уникальный ID платежа (UUID или автоинкремент)
- Статус: "Создан" (по умолчанию)

Данные должны сохраняться в PostgreSQL.

### 3.3. Подтверждение/отмена платежа

- Возможность изменения статуса платежа на "Оплачен" или "Отменен"
- При изменении статуса — обновляется соответствующая запись в БД
- Запрет на изменение уже завершённых платежей ("Оплачен", "Отменен")

При смене сатуса платежа баланс у одного пользователя отнимается другому начисляется.

### 3.4. Получение списка платежей

- Получение всех платежей текущего пользователя
- Фильтрация по статусу, дате, сумме — по желанию

### 3.5. Логирование и отладка

- Логирование основных событий работы сервиса
- Возможность просмотра логов через `docker logs`

## 4. Нефункциональные требования

- Код должен быть покрыт unit-тестами (pytest)
- Наличие README с инструкцией по запуску и использованию
- Использование `.env` файла для хранения конфигураций
- Поддержка миграций (например, с помощью Alembic)
- Простой и понятный интерфейс API (можно использовать Swagger UI от FastAPI)
- Чистый код, соблюдение PEP8

## 5. Архитектура проекта

Проект должен быть организован следующим образом:

```
├── app/
│   ├── main.py
│   ├── models/
│   ├── schemas/
│   ├── routers/
│   ├── services/
│   ├── core/
│   └── utils/
├── alembic/
├── tests/
├── Dockerfile
├── docker-compose.yml
├── requirements.txt
└── .env.example
```

## 6. Дополнительно (по желанию)

- Реализация фоновой задачи через Celery и Redis (например, отправка уведомления при оплате)
- Интеграция с платежным шлюзом (mock-ответы допускаются)
- Реализация простого фронтенда для управления платежами
- CI/CD pipeline (GitHub Actions, GitLab CI и т.п.)

## 7. Результат

На выходе должен быть готовый репозиторий с рабочим сервисом, который:

- Разворачивается командой `docker-compose up`
- Доступен по адресу `http://localhost:8000`
- Имеет документацию API (Swagger или ReDoc)
- Содержит примеры запросов и ответов
